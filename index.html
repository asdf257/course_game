<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é©å‘½å­¦å ‚ - æŠ—æ—¥æ ¹æ®åœ°å…»æˆæ¸¸æˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700;900&family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <style>
        :root {
            --red-primary: #C41E3A;
            --red-dark: #8B0000;
            --red-deep: #5C0000;
            --gold-primary: #D4AF37;
            --gold-light: #F4D03F;
            --cream: #FDF5E6;
            --paper: #F5E6C8;
            --ink: #2C1810;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Serif SC', serif;
            background: linear-gradient(135deg, var(--red-deep) 0%, var(--red-dark) 50%, #3D0000 100%);
            min-height: 100vh;
            color: var(--ink);
            overflow-x: hidden;
        }

        /* èƒŒæ™¯è£…é¥° */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 5L35 25H55L39 37L44 57L30 45L16 57L21 37L5 25H25L30 5Z' fill='rgba(212,175,55,0.03)'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        /* å¼€å§‹ç•Œé¢ */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, var(--red-deep) 0%, var(--red-dark) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .start-screen.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .start-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 4rem;
            color: var(--gold-primary);
            text-shadow: 
                3px 3px 0 var(--red-deep),
                0 0 30px rgba(212, 175, 55, 0.5);
            margin-bottom: 20px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 3px 3px 0 var(--red-deep), 0 0 30px rgba(212, 175, 55, 0.3); }
            to { text-shadow: 3px 3px 0 var(--red-deep), 0 0 50px rgba(212, 175, 55, 0.7); }
        }

        .start-subtitle {
            font-size: 1.5rem;
            color: var(--cream);
            margin-bottom: 40px;
            opacity: 0.9;
        }

        .star-decoration {
            width: 80px;
            height: 80px;
            margin-bottom: 30px;
            animation: rotateStar 20s linear infinite;
        }

        @keyframes rotateStar {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .start-story {
            max-width: 600px;
            text-align: center;
            color: var(--paper);
            line-height: 2;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 2px solid var(--gold-primary);
        }

        .start-btn {
            padding: 20px 60px;
            font-size: 1.5rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            color: var(--red-deep);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .start-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 40px rgba(212, 175, 55, 0.4);
        }

        /* ä¸»æ¸¸æˆç•Œé¢ */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            background: linear-gradient(90deg, rgba(0,0,0,0.8), rgba(92, 0, 0, 0.9), rgba(0,0,0,0.8));
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid var(--gold-primary);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .game-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.8rem;
            color: var(--gold-primary);
        }

        .week-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .week-badge {
            background: var(--gold-primary);
            color: var(--red-deep);
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .progress-ring {
            width: 60px;
            height: 60px;
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* ä¸»è¦æ¸¸æˆåŒºåŸŸ */
        .main-area {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        /* å±æ€§é¢æ¿ */
        .stats-panel {
            background: linear-gradient(180deg, var(--paper) 0%, var(--cream) 100%);
            border-radius: 15px;
            padding: 25px;
            border: 3px solid var(--gold-primary);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                inset 0 0 50px rgba(212, 175, 55, 0.1);
        }

        .stats-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.5rem;
            color: var(--red-dark);
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed var(--gold-primary);
        }

        .stat-item {
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: scale(1.02);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .stat-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 1rem;
        }

        .stat-name {
            font-weight: bold;
            flex: 1;
            margin-left: 10px;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--red-dark);
        }

        .stat-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .political-fill { background: linear-gradient(90deg, #C41E3A, #FF4757); }
        .military-fill { background: linear-gradient(90deg, #1565c0, #5C9CE5); }
        .labor-fill { background: linear-gradient(90deg, #2e7d32, #4CAF50); }
        .mass-fill { background: linear-gradient(90deg, #6a1b9a, #9C27B0); }

        .political-icon { background: #FFE0E0; color: #C41E3A; }
        .military-icon { background: #E0F0FF; color: #1565c0; }
        .labor-icon { background: #E0FFE0; color: #2e7d32; }
        .mass-icon { background: #F0E0FF; color: #6a1b9a; }

        /* è¯¾ç¨‹é€‰æ‹©åŒº */
        .courses-area {
            background: linear-gradient(180deg, var(--paper) 0%, var(--cream) 100%);
            border-radius: 15px;
            padding: 25px;
            border: 3px solid var(--gold-primary);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .courses-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px dashed var(--gold-primary);
        }

        .courses-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.5rem;
            color: var(--red-dark);
        }

        .selection-counter {
            background: var(--red-dark);
            color: var(--gold-primary);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .course-category {
            margin-bottom: 25px;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .category-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--ink);
        }

        .courses-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .course-card {
            position: relative;
            padding: 15px 15px 12px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            overflow: hidden;
            min-height: 90px;
        }

        .course-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--card-color, #ddd);
        }

        .course-card:hover:not(.disabled):not(.selected) {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: var(--card-color, var(--gold-primary));
        }

        .course-card.selected {
            background: linear-gradient(135deg, var(--gold-light), var(--gold-primary));
            border-color: var(--gold-primary);
            transform: scale(0.98);
        }

        .course-card.selected .course-name {
            color: var(--red-deep);
            font-weight: bold;
        }

        .course-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .course-card.locked {
            opacity: 0.6;
            cursor: not-allowed;
            background: #f0f0f0;
            border-style: dashed;
        }

        .course-card.locked:hover {
            transform: none;
            box-shadow: none;
        }

        .course-card.locked .course-name {
            color: #888;
        }

        .course-card.completed {
            opacity: 0.5;
            cursor: not-allowed;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
        }

        .course-card.political { --card-color: #C41E3A; }
        .course-card.military { --card-color: #1565c0; }
        .course-card.labor { --card-color: #2e7d32; }
        .course-card.mass { --card-color: #6a1b9a; }

        .course-name {
            font-size: 0.9rem;
            color: var(--ink);
            line-height: 1.3;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .course-level {
            display: block;
            font-size: 0.7rem;
            color: var(--gold-primary);
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .course-points {
            display: inline-block;
            font-size: 0.75rem;
            color: white;
            background: var(--card-color, #888);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
        }

        .course-lock-icon {
            position: absolute;
            top: 8px;
            left: 8px;
            font-size: 1rem;
        }

        .course-lock-reasons {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #ccc;
            font-size: 0.75rem;
            text-align: left;
        }

        .lock-reason-item {
            color: #888;
            margin-bottom: 3px;
            display: flex;
            align-items: center;
            gap: 4px;
            line-height: 1.4;
        }

        .lock-reason-item:last-child {
            margin-bottom: 0;
        }

        .course-card.locked .course-lock-reasons {
            display: block;
        }

        .course-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--gold-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--red-deep);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .course-card.selected .course-badge {
            opacity: 1;
        }

        .no-courses {
            grid-column: 1 / -1;
            text-align: center;
            padding: 20px;
            color: #888;
            font-style: italic;
            background: rgba(0,0,0,0.03);
            border-radius: 8px;
        }

        /* è¯¾ç¨‹è¿›åº¦æ¡ */
        .course-progress {
            margin-top: 8px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .course-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-light));
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .course-progress-text {
            font-size: 0.7rem;
            color: #888;
            margin-top: 4px;
        }

        /* ç‰¹æ®Šæ´»åŠ¨æ ·å¼ */
        .activity-category {
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff) !important;
        }

        .activity-icon {
            background: #FFE0B2 !important;
            color: #E65100 !important;
        }

        .category-hint {
            font-size: 0.8rem;
            color: #888;
            font-weight: normal;
            margin-left: 10px;
        }

        .activity-card {
            background: linear-gradient(135deg, #fff8e1, #ffecb3) !important;
            border-color: #FFB74D !important;
        }

        .activity-card::before {
            background: #FF9800 !important;
        }

        .activity-card:hover:not(.selected) {
            border-color: #FF9800 !important;
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.2) !important;
        }

        .activity-card.selected {
            background: linear-gradient(135deg, #FFB74D, #FFA726) !important;
        }

        .activity-icon-large {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .activity-effect {
            font-size: 0.75rem;
            color: #666;
            margin-top: 5px;
        }

        .activity-effect .positive {
            color: #2e7d32;
        }

        .activity-effect .negative {
            color: #c62828;
        }

        /* å¯é‡å¤å­¦ä¹ æ ‡è¯† */
        .course-repeatable {
            position: absolute;
            bottom: 8px;
            right: 8px;
            font-size: 0.7rem;
            color: #888;
            background: rgba(0,0,0,0.05);
            padding: 2px 6px;
            border-radius: 8px;
        }

        /* æœ¬å‘¨é€‰æ‹©ç¡®è®¤ */
        .week-selection {
            margin-top: 25px;
            padding: 20px;
            background: rgba(196, 30, 58, 0.1);
            border-radius: 10px;
            border: 2px solid var(--red-primary);
        }

        .selection-title {
            font-weight: bold;
            color: var(--red-dark);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .selected-courses {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 40px;
        }

        .selected-tag {
            padding: 8px 15px;
            background: var(--gold-primary);
            color: var(--red-deep);
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: tagPop 0.3s ease;
        }

        @keyframes tagPop {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .selected-tag .remove-btn {
            cursor: pointer;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .selected-tag .remove-btn:hover {
            opacity: 1;
        }

        .confirm-btn {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            background: linear-gradient(135deg, var(--red-dark), var(--red-primary));
            color: var(--gold-primary);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .confirm-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(196, 30, 58, 0.4);
        }

        .confirm-btn:disabled {
            background: #ccc;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* æ¶ˆæ¯æç¤ºåŒº */
        .message-area {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--paper), var(--cream));
            border-radius: 15px;
            border: 3px solid var(--gold-primary);
            min-height: 100px;
        }

        .message-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.2rem;
            color: var(--red-dark);
            margin-bottom: 10px;
        }

        .message-content {
            line-height: 1.8;
            color: var(--ink);
        }

        /* äº‹ä»¶å¼¹çª— */
        .event-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .event-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .event-card {
            background: linear-gradient(180deg, var(--paper), var(--cream));
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            text-align: center;
            border: 4px solid var(--gold-primary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.8);
            transition: transform 0.3s ease;
        }

        .event-modal.show .event-card {
            transform: scale(1);
        }

        .event-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: var(--gold-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
        }

        .event-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.8rem;
            color: var(--red-dark);
            margin-bottom: 20px;
        }

        .event-description {
            line-height: 1.8;
            margin-bottom: 25px;
            color: var(--ink);
        }

        .event-question {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--red-dark);
            margin: 20px 0 15px;
            font-family: 'ZCOOL KuaiLe', cursive;
        }

        .event-choices {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .event-choice-btn {
            padding: 15px 20px;
            font-size: 1rem;
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .event-choice-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--choice-color, var(--gold-primary));
        }

        .event-choice-btn:hover {
            transform: translateX(5px);
            border-color: var(--choice-color, var(--gold-primary));
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .event-choice-btn.political { --choice-color: #C41E3A; }
        .event-choice-btn.military { --choice-color: #1565c0; }
        .event-choice-btn.labor { --choice-color: #2e7d32; }
        .event-choice-btn.mass { --choice-color: #6a1b9a; }
        .event-choice-btn.balanced { --choice-color: var(--gold-primary); }

        .choice-text {
            font-weight: bold;
            color: var(--ink);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .choice-icon {
            font-size: 1.2rem;
        }

        .choice-effect {
            font-size: 0.85rem;
            color: #666;
            padding-left: 28px;
        }

        .choice-effect span {
            display: inline-block;
            background: rgba(0,0,0,0.05);
            padding: 2px 8px;
            border-radius: 10px;
            margin-right: 5px;
            font-weight: bold;
        }

        .choice-effect .political-effect { color: #C41E3A; }
        .choice-effect .military-effect { color: #1565c0; }
        .choice-effect .labor-effect { color: #2e7d32; }
        .choice-effect .mass-effect { color: #6a1b9a; }

        /* é€‰æ‹©ç»“æœå¼¹çª— */
        .event-result {
            display: none;
            padding: 20px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
            border-radius: 12px;
            margin-top: 15px;
            border: 2px solid var(--gold-primary);
            animation: resultPop 0.3s ease;
        }

        @keyframes resultPop {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .event-result.show {
            display: block;
        }

        .result-text {
            color: var(--ink);
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .result-effect {
            font-weight: bold;
            color: var(--red-dark);
            font-size: 1.1rem;
        }

        .event-continue-btn {
            margin-top: 15px;
            padding: 12px 30px;
            font-size: 1rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            background: linear-gradient(135deg, var(--red-dark), var(--red-primary));
            color: var(--gold-primary);
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .event-continue-btn.show {
            display: inline-block;
        }

        .event-continue-btn:hover {
            transform: scale(1.05);
        }

        /* å­¦ä¹ æ€»ç»“å¼¹çª— */
        .summary-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .summary-modal.show {
            opacity: 1;
            pointer-events: all;
        }

        .summary-card {
            background: linear-gradient(180deg, var(--paper), var(--cream));
            border-radius: 20px;
            padding: 30px 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 4px solid var(--gold-primary);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.8) translateY(30px);
            transition: transform 0.4s ease;
        }

        .summary-modal.show .summary-card {
            transform: scale(1) translateY(0);
        }

        .summary-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px dashed var(--gold-primary);
        }

        .summary-week-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--red-dark), var(--red-primary));
            color: var(--gold-primary);
            padding: 10px 30px;
            border-radius: 25px;
            font-size: 1.3rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .summary-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 1.8rem;
            color: var(--red-dark);
        }

        .summary-courses {
            margin-bottom: 25px;
        }

        .summary-course-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 4px solid var(--gold-primary);
            animation: slideInRight 0.4s ease forwards;
            opacity: 0;
        }

        .summary-course-item:nth-child(1) { animation-delay: 0.1s; }
        .summary-course-item:nth-child(2) { animation-delay: 0.2s; }
        .summary-course-item:nth-child(3) { animation-delay: 0.3s; }
        .summary-course-item:nth-child(4) { animation-delay: 0.4s; }
        .summary-course-item:nth-child(5) { animation-delay: 0.5s; }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .summary-course-item.political { border-left-color: #C41E3A; }
        .summary-course-item.military { border-left-color: #1565c0; }
        .summary-course-item.labor { border-left-color: #2e7d32; }
        .summary-course-item.mass { border-left-color: #6a1b9a; }

        .summary-course-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .summary-course-icon.political { background: #FFE0E0; }
        .summary-course-icon.military { background: #E0F0FF; }
        .summary-course-icon.labor { background: #E0FFE0; }
        .summary-course-icon.mass { background: #F0E0FF; }

        .summary-course-content {
            flex: 1;
        }

        .summary-course-name {
            font-weight: bold;
            color: var(--ink);
            margin-bottom: 5px;
            font-size: 1.05rem;
        }

        .summary-course-desc {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .summary-course-points {
            background: var(--gold-primary);
            color: var(--red-deep);
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85rem;
            white-space: nowrap;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            padding: 20px;
            background: rgba(196, 30, 58, 0.08);
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .summary-stat {
            text-align: center;
            padding: 10px;
        }

        .summary-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--red-dark);
        }

        .summary-stat-change {
            font-size: 0.9rem;
            color: #2e7d32;
            font-weight: bold;
        }

        .summary-stat-change.positive {
            color: #27ae60;
        }

        .summary-stat-change.negative {
            color: #c62828;
        }

        .activity-effect-summary {
            color: #e65100 !important;
        }

        .summary-course-item.activity {
            background: linear-gradient(135deg, #fff8e1, #ffecb3);
            border-left-color: #FF9800;
        }

        .summary-course-icon.activity {
            background: #FFE0B2;
        }

        .summary-stat-name {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .summary-btn {
            display: block;
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            background: linear-gradient(135deg, var(--red-dark), var(--red-primary));
            color: var(--gold-primary);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .summary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(196, 30, 58, 0.4);
        }

        /* ç»“å±€ç•Œé¢ */
        .ending-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg, var(--red-deep) 0%, #1a0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .ending-screen.show {
            opacity: 1;
            pointer-events: all;
        }

        .ending-badge {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            box-shadow: 
                0 0 30px rgba(212, 175, 55, 0.5),
                0 0 60px rgba(212, 175, 55, 0.3);
            animation: badgePulse 2s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.5), 0 0 60px rgba(212, 175, 55, 0.3); }
            50% { box-shadow: 0 0 50px rgba(212, 175, 55, 0.7), 0 0 100px rgba(212, 175, 55, 0.5); }
        }

        .ending-badge-icon {
            font-size: 4rem;
        }

        .ending-title {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 2rem;
            color: var(--cream);
            margin-bottom: 15px;
        }

        .ending-identity {
            font-family: 'ZCOOL KuaiLe', cursive;
            font-size: 3rem;
            color: var(--gold-primary);
            text-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
            margin-bottom: 30px;
        }

        .ending-description {
            max-width: 600px;
            text-align: center;
            color: var(--cream);
            line-height: 2;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 2px solid var(--gold-primary);
        }

        .final-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .final-stat {
            background: rgba(255,255,255,0.1);
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--gold-primary);
        }

        .final-stat-value {
            font-size: 2.5rem;
            color: var(--gold-primary);
            font-weight: bold;
        }

        .final-stat-name {
            color: var(--cream);
            margin-top: 5px;
        }

        .restart-btn {
            padding: 20px 60px;
            font-size: 1.5rem;
            font-family: 'ZCOOL KuaiLe', cursive;
            background: linear-gradient(135deg, var(--gold-primary), var(--gold-light));
            color: var(--red-deep);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 900px) {
            .main-area {
                grid-template-columns: 1fr;
            }

            .start-title {
                font-size: 2.5rem;
            }

            .courses-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--red-deep);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;
            transition: opacity 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-star {
            width: 100px;
            height: 100px;
            animation: loadingSpin 1s linear infinite;
        }

        @keyframes loadingSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½ç•Œé¢ -->
    <div class="loading-overlay" id="loading">
        <svg class="loading-star" viewBox="0 0 100 100">
            <polygon points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40" fill="#D4AF37"/>
        </svg>
    </div>

    <!-- å¼€å§‹ç•Œé¢ -->
    <div class="start-screen" id="startScreen">
        <svg class="star-decoration" viewBox="0 0 100 100">
            <polygon points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40" fill="#D4AF37"/>
        </svg>
        <h1 class="start-title">é©å‘½å­¦å ‚</h1>
        <p class="start-subtitle">æŠ—æ—¥æ ¹æ®åœ°å­¦ä¹ å…»æˆæ¸¸æˆ</p>
        <div class="start-story">
            <p>1938å¹´ï¼Œæˆ˜ç«çº·é£çš„å¹´ä»£ã€‚</p>
            <p>ä½ ä½œä¸ºä¸€åçƒ­è¡€é’å¹´ï¼Œæ¥åˆ°äº†æŠ—æ—¥æ ¹æ®åœ°çš„é©å‘½å­¦æ ¡ã€‚</p>
            <p>åœ¨è¿™é‡Œï¼Œä½ å°†åº¦è¿‡8å‘¨çš„ç´§å¼ å­¦ä¹ ç”Ÿæ´»ã€‚</p>
            <p>æ¯å‘¨é€‰æ‹©5é—¨è¯¾ç¨‹ï¼Œæœ‰äº›é«˜çº§è¯¾ç¨‹éœ€è¦å…ˆä¿®åŸºç¡€è¯¾ç¨‹ã€‚</p>
            <p>ä½ çš„é€‰æ‹©å°†å†³å®šä½ æœ€ç»ˆæˆä¸ºä»€ä¹ˆæ ·çš„é©å‘½æˆ˜å£«ï¼</p>
        </div>
        <button class="start-btn" onclick="startGame()">å¼€å§‹å­¦ä¹ </button>
    </div>

    <!-- ä¸»æ¸¸æˆç•Œé¢ -->
    <div class="game-container" id="gameContainer">
        <!-- é¡¶éƒ¨ä¿¡æ¯æ  -->
        <div class="top-bar">
            <h1 class="game-title">â­ é©å‘½å­¦å ‚ â­</h1>
            <div class="week-display">
                <div class="week-badge">ç¬¬ <span id="currentWeek">1</span> å‘¨ / 8å‘¨</div>
                <svg class="progress-ring" viewBox="0 0 60 60">
                    <circle cx="30" cy="30" r="25" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="5"/>
                    <circle id="progressCircle" class="progress-ring-circle" cx="30" cy="30" r="25" fill="none" stroke="#D4AF37" stroke-width="5" stroke-dasharray="157" stroke-dashoffset="157"/>
                </svg>
            </div>
        </div>

        <div class="main-area">
            <!-- å±æ€§é¢æ¿ -->
            <div class="stats-panel">
                <h2 class="stats-title">ğŸ“Š èƒ½åŠ›å±æ€§</h2>
                
                <div class="stat-item">
                    <div class="stat-header">
                        <span class="stat-icon political-icon">ğŸ“•</span>
                        <span class="stat-name">æ”¿æ²»ç´ å…»</span>
                        <span class="stat-value" id="politicalValue">10</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill political-fill" id="politicalBar" style="width: 10%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-header">
                        <span class="stat-icon military-icon">âš”ï¸</span>
                        <span class="stat-name">å†›äº‹èƒ½åŠ›</span>
                        <span class="stat-value" id="militaryValue">10</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill military-fill" id="militaryBar" style="width: 10%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-header">
                        <span class="stat-icon labor-icon">ğŸ”¨</span>
                        <span class="stat-name">åŠ³åŠ¨æŠ€èƒ½</span>
                        <span class="stat-value" id="laborValue">10</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill labor-fill" id="laborBar" style="width: 10%"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-header">
                        <span class="stat-icon mass-icon">ğŸ‘¥</span>
                        <span class="stat-name">ç¾¤ä¼—å·¥ä½œ</span>
                        <span class="stat-value" id="massValue">10</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill mass-fill" id="massBar" style="width: 10%"></div>
                    </div>
                </div>
            </div>

            <!-- è¯¾ç¨‹é€‰æ‹©åŒº -->
            <div class="courses-area">
                <div class="courses-header">
                    <h2 class="courses-title">ğŸ“š è¯¾ç¨‹é€‰æ‹©</h2>
                    <div class="selection-counter">å·²é€‰ <span id="selectionCount">0</span> / 5 é¡¹ï¼ˆå¯å°‘é€‰ï¼‰</div>
                </div>

                <!-- æ”¿æ²»æ•™è‚² -->
                <div class="course-category">
                    <div class="category-header">
                        <div class="category-icon political-icon">ğŸ“•</div>
                        <span class="category-title">é©å‘½çš„æ”¿æ²»æ•™è‚²</span>
                    </div>
                    <div class="courses-grid" id="politicalCourses"></div>
                </div>

                <!-- æ°‘ä¼—è¿åŠ¨ -->
                <div class="course-category">
                    <div class="category-header">
                        <div class="category-icon mass-icon">ğŸ‘¥</div>
                        <span class="category-title">æ°‘ä¼—è¿åŠ¨å’Œæ”¿åºœå·¥ä½œæ•™è‚²</span>
                    </div>
                    <div class="courses-grid" id="massCourses"></div>
                </div>

                <!-- å†›äº‹æ•™è‚² -->
                <div class="course-category">
                    <div class="category-header">
                        <div class="category-icon military-icon">âš”ï¸</div>
                        <span class="category-title">å†›äº‹æ•™è‚²</span>
                    </div>
                    <div class="courses-grid" id="militaryCourses"></div>
                </div>

                <!-- åŠ³åŠ¨æ•™è‚² -->
                <div class="course-category">
                    <div class="category-header">
                        <div class="category-icon labor-icon">ğŸ”¨</div>
                        <span class="category-title">åŠ³åŠ¨æ•™è‚²</span>
                    </div>
                    <div class="courses-grid" id="laborCourses"></div>
                </div>

                <!-- ç‰¹æ®Šæ´»åŠ¨ -->
                <div class="course-category activity-category">
                    <div class="category-header">
                        <div class="category-icon activity-icon">ğŸ¯</div>
                        <span class="category-title">è¯¾ä½™æ´»åŠ¨</span>
                        <span class="category-hint">ï¼ˆå¯é€‰ï¼Œä¼šå½±å“å±æ€§ï¼‰</span>
                    </div>
                    <div class="courses-grid" id="specialActivities"></div>
                </div>

                <!-- æœ¬å‘¨é€‰æ‹© -->
                <div class="week-selection">
                    <div class="selection-title">ğŸ“‹ æœ¬å‘¨è¯¾ç¨‹å®‰æ’ï¼š</div>
                    <div class="selected-courses" id="selectedCourses"></div>
                    <button class="confirm-btn" id="confirmBtn" onclick="confirmWeek()" disabled>ç¡®è®¤æœ¬å‘¨è¯¾ç¨‹</button>
                </div>
            </div>
        </div>

        <!-- æ¶ˆæ¯åŒº -->
        <div class="message-area">
            <div class="message-title">ğŸ“œ å­¦ä¹ æ—¥å¿—</div>
            <div class="message-content" id="messageContent">æ¬¢è¿æ¥åˆ°é©å‘½å­¦å ‚ï¼è¯·é€‰æ‹©æœ¬å‘¨è¦å­¦ä¹ çš„5é—¨è¯¾ç¨‹ã€‚æ¯é—¨è¯¾ç¨‹éƒ½ä¼šæå‡ä½ ç›¸åº”çš„èƒ½åŠ›å±æ€§ã€‚</div>
        </div>
    </div>

    <!-- å­¦ä¹ æ€»ç»“å¼¹çª— -->
    <div class="summary-modal" id="summaryModal">
        <div class="summary-card">
            <div class="summary-header">
                <div class="summary-week-badge" id="summaryWeekBadge">ç¬¬ 1 å‘¨</div>
                <h3 class="summary-title">ğŸ“œ æœ¬å‘¨å­¦ä¹ æ€»ç»“</h3>
            </div>
            <div class="summary-courses" id="summaryCourses">
                <!-- è¯¾ç¨‹åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="summary-stats" id="summaryStats">
                <!-- å±æ€§å˜åŒ–å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            <button class="summary-btn" onclick="closeSummary()">ç»§ç»­ä¸‹ä¸€å‘¨ â†’</button>
        </div>
    </div>

    <!-- äº‹ä»¶å¼¹çª— -->
    <div class="event-modal" id="eventModal">
        <div class="event-card">
            <div class="event-icon" id="eventIcon">ğŸ“¢</div>
            <h3 class="event-title" id="eventTitle">ç‰¹åˆ«äº‹ä»¶</h3>
            <p class="event-description" id="eventDescription"></p>
            <div class="event-question" id="eventQuestion">ä½ ä¼šæ€ä¹ˆåšï¼Ÿ</div>
            <div class="event-choices" id="eventChoices">
                <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
    </div>

    <!-- ç»“å±€ç•Œé¢ -->
    <div class="ending-screen" id="endingScreen">
        <div class="ending-badge">
            <span class="ending-badge-icon" id="endingIcon">ğŸ“</span>
        </div>
        <h2 class="ending-title">å­¦æœŸç»“æŸï¼ä½ çš„æœ€ç»ˆè¯„ä»·æ˜¯ï¼š</h2>
        <div class="ending-identity" id="endingIdentity"></div>
        <div class="ending-description" id="endingDescription"></div>
        <div class="final-stats" id="finalStats"></div>
        <button class="restart-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // è¯¾ç¨‹æ•°æ®ï¼ˆå¸¦å¤šç§è§£é”æ¡ä»¶ï¼‰
        // prerequisites: éœ€è¦å…ˆå­¦è¿‡çš„è¯¾ç¨‹IDæ•°ç»„
        // requiredWeek: éœ€è¦åˆ°è¾¾ç¬¬å‡ å‘¨æ‰å¼€æ”¾
        // requiredTimes: éœ€è¦å­¦ä¹ å‡ æ¬¡æ‰èƒ½å®Œå…¨æŒæ¡ï¼ˆé»˜è®¤1æ¬¡ï¼‰
        const allCourses = {
            political: [
                // åŸºç¡€è¯¾ç¨‹ï¼ˆæ— å‰ç½®ï¼‰
                { id: "p1", name: "ç¤¾ä¼šç§‘å­¦æ¦‚è®º", type: "political", points: 3, description: "å­¦ä¹ äº†ç¤¾ä¼šç»“æ„çš„åŸºæœ¬åŸç†ï¼Œç†è§£äº†ç¤¾ä¼šå‘å±•çš„è§„å¾‹ã€‚", prerequisites: [], level: 1, requiredTimes: 2 },
                { id: "p2", name: "ä¸­å›½é©å‘½è¿åŠ¨å²", type: "political", points: 3, description: "äº†è§£äº†é©å‘½å…ˆè¾ˆçš„å¥‹æ–—å†ç¨‹ï¼Œæ›´åŠ åšå®šäº†é©å‘½ä¿¡å¿µã€‚", prerequisites: [], level: 1, requiredTimes: 2 },
                { id: "p3", name: "æ—¶äº‹æ”¿æ²»æŠ¥å‘Š", type: "political", points: 2, description: "åŠæ—¶äº†è§£å½“å‰æ”¿æ²»åŠ¨æ€ï¼Œå­¦ä¼šäº†å°†ç†è®ºä¸ç°å®ç›¸ç»“åˆã€‚", prerequisites: [], level: 1 },
                { id: "p4", name: "ä¸‰æ°‘ä¸»ä¹‰ç ”ç©¶", type: "political", points: 2, description: "ç†è§£äº†å­™ä¸­å±±çš„æ€æƒ³ï¼Œè®¤è¯†äº†æ—§æ°‘ä¸»ä¸»ä¹‰é©å‘½çš„å±€é™æ€§ã€‚", prerequisites: [], requiredWeek: 2, level: 1 },
                // è¿›é˜¶è¯¾ç¨‹
                { id: "p5", name: "æŠ—æ—¥æ°‘æ—ç»Ÿä¸€æˆ˜çº¿", type: "political", points: 4, description: "è®¤è¯†åˆ°å›¢ç»“ä¸€åˆ‡å¯ä»¥å›¢ç»“çš„åŠ›é‡çš„é‡è¦æ€§ï¼Œæ°‘æ—å¤§ä¹‰é«˜äºä¸€åˆ‡ã€‚", prerequisites: ["p2"], level: 2 },
                { id: "p6", name: "æ”¿æ²»ç»æµå­¦", type: "political", points: 3, description: "æ­ç¤ºäº†ç»æµåŸºç¡€ä¸ä¸Šå±‚å»ºç­‘çš„å…³ç³»ï¼Œç†è§£äº†ç”Ÿäº§å…³ç³»å¯¹ç¤¾ä¼šçš„å†³å®šæ€§ä½œç”¨ã€‚", prerequisites: ["p1"], level: 2, requiredTimes: 2 },
                { id: "p7", name: "è¾©è¯å”¯ç‰©ä¸»ä¹‰", type: "political", points: 4, description: "å­¦ä¼šç”¨å‘å±•çš„çœ¼å…‰çœ‹é—®é¢˜ï¼Œæ˜ç™½äº†äº‹ç‰©å‘å±•çš„å†…åœ¨è§„å¾‹ã€‚", prerequisites: ["p1"], requiredWeek: 2, level: 2, requiredTimes: 2 },
                { id: "p8", name: "ä¸–ç•Œé©å‘½è¿åŠ¨å²", type: "political", points: 3, description: "äº†è§£äº†å›½é™…å…±è¿çš„å†ç¨‹ï¼Œæ˜ç™½äº†ä¸­å›½é©å‘½æ˜¯ä¸–ç•Œé©å‘½çš„ä¸€éƒ¨åˆ†ã€‚", prerequisites: ["p2"], level: 2 },
                { id: "p9", name: "ä¸­å›½é—®é¢˜", type: "political", points: 4, description: "æ·±å…¥äº†è§£äº†ä¸­å›½çš„å›½æƒ…å’ŒæŒ‘æˆ˜ï¼Œæ˜ç™½äº†ä¸­å›½é©å‘½çš„ç‰¹æ®Šæ€§ã€‚", prerequisites: ["p2", "p4"], level: 2 },
                // é«˜çº§è¯¾ç¨‹
                { id: "p10", name: "é©¬åˆ—ä¸»ä¹‰", type: "political", points: 5, description: "æŒæ¡äº†ç§‘å­¦çš„ä¸–ç•Œè§‚å’Œæ–¹æ³•è®ºï¼Œçœ‹æ¸…äº†å†å²å‘å±•æ–¹å‘ã€‚", prerequisites: ["p6", "p7"], requiredWeek: 4, level: 3, requiredTimes: 3 },
                { id: "p11", name: "ç§‘å­¦ç¤¾ä¼šä¸»ä¹‰", type: "political", points: 4, description: "å¯¹ç¤¾ä¼šä¸»ä¹‰å¿…ç„¶èƒœåˆ©å……æ»¡ä¿¡å¿ƒï¼Œç†è§£äº†ç¤¾ä¼šä¸»ä¹‰å–ä»£èµ„æœ¬ä¸»ä¹‰çš„å†å²å¿…ç„¶æ€§ã€‚", prerequisites: ["p7", "p8"], requiredWeek: 4, level: 3 },
                { id: "p12", name: "ä¸–ç•Œæ”¿æ²»", type: "political", points: 3, description: "äº†è§£äº†å›½é™…æ ¼å±€çš„å˜åŒ–ï¼Œæ˜ç™½äº†ä¸­å›½åœ¨å›½é™…èˆå°ä¸Šçš„åœ°ä½å’Œä½œç”¨ã€‚", prerequisites: ["p8"], requiredWeek: 3, level: 3 },
                { id: "p13", name: "æˆ˜åŒºæ”¿æ²»å·¥ä½œ", type: "political", points: 4, description: "å­¦ä¼šäº†å¦‚ä½•åœ¨æˆ˜æ—¶å¼€å±•æ”¿æ²»å·¥ä½œï¼Œæ˜ç™½äº†æ”¿æ²»å·¥ä½œå¯¹å†›äº‹èƒœåˆ©çš„é‡è¦æ€§ã€‚", prerequisites: ["p5", "p9"], requiredWeek: 5, level: 3 },
                { id: "p14", name: "å…šè¯¾", type: "political", points: 5, description: "å¼ºåŒ–äº†å…šæ€§ä¿®å…»ï¼Œæ˜ç™½äº†å…±äº§å…šå‘˜çš„ä½¿å‘½å’Œè´£ä»»ã€‚", prerequisites: ["p10"], requiredWeek: 6, level: 4, requiredTimes: 2 }
            ],
            mass: [
                { id: "m1", name: "ç¤¾ä¼šå®è·µ", type: "mass", points: 3, description: "æ·±å…¥ç¾¤ä¼—äº†è§£ä»–ä»¬çš„éœ€æ±‚ï¼Œé”»ç‚¼äº†è§£å†³å®é™…é—®é¢˜çš„èƒ½åŠ›ã€‚", prerequisites: [], level: 1, requiredTimes: 2 },
                { id: "m2", name: "æ°‘ä¼—è¿åŠ¨çš„ç†è®ºå’Œç»éªŒ", type: "mass", points: 4, description: "å­¦ä¼šäº†å¦‚ä½•å‘åŠ¨å’Œç»„ç»‡ç¾¤ä¼—ï¼Œæ˜ç™½äº†åªæœ‰ä¾é ç¾¤ä¼—æ‰èƒ½å–å¾—é©å‘½èƒœåˆ©ã€‚", prerequisites: ["m1"], requiredWeek: 3, level: 2 },
                { id: "m3", name: "å»ºç«‹æ•ŒåæŠ—æ—¥æ ¹æ®åœ°æ”¿æƒçš„ç†è®ºå’Œæ”¿ç­–", type: "mass", points: 5, description: "äº†è§£äº†æ ¹æ®åœ°æ”¿æƒå»ºè®¾çš„åŸåˆ™ï¼ŒæŒæ¡äº†æ”¿ç­–åˆ¶å®šçš„æ–¹æ³•ã€‚", prerequisites: ["m2", "p5"], requiredWeek: 5, level: 3 }
            ],
            military: [
                { id: "mi1", name: "å†›äº‹è®­ç»ƒ", type: "military", points: 3, description: "é”»ç‚¼äº†ä½“èƒ½å’Œå†›äº‹æŠ€èƒ½ï¼ŒåŸ¹å…»äº†å†›äººåº”æœ‰çš„çºªå¾‹å’Œä½œé£ã€‚", prerequisites: [], level: 1, requiredTimes: 3 },
                { id: "mi2", name: "å†›äº‹ç”Ÿæ´»ç®¡ç†", type: "military", points: 2, description: "å­¦ä¼šäº†å¦‚ä½•ç®¡ç†éƒ¨é˜Ÿæ—¥å¸¸ç”Ÿæ´»ï¼Œæ˜ç™½äº†æ—¥å¸¸ç®¡ç†å¯¹éƒ¨é˜Ÿæˆ˜æ–—åŠ›çš„é‡è¦æ€§ã€‚", prerequisites: [], level: 1 },
                { id: "mi3", name: "æ­¥å…µæˆ˜æœ¯", type: "military", points: 4, description: "äº†è§£äº†åŸºæœ¬æˆ˜æœ¯åŠ¨ä½œå’Œé˜Ÿå½¢ï¼Œèƒ½å¤ŸæŒ‡æŒ¥æ­¥å…µç­ç»„ä½œæˆ˜ã€‚", prerequisites: ["mi1"], requiredWeek: 2, level: 2, requiredTimes: 2 },
                { id: "mi4", name: "æ¸¸å‡»æˆ˜äº‰", type: "military", points: 5, description: "æŒæ¡äº†çµæ´»æœºåŠ¨çš„æˆ˜æœ¯ï¼Œä»¥å¼±èƒœå¼ºçš„æˆ˜æ³•ã€‚", prerequisites: ["mi3"], requiredWeek: 4, level: 3, requiredTimes: 2 },
                { id: "mi5", name: "ç‰¹ç§æˆ˜æ–—æ•™è‚²", type: "military", points: 4, description: "å­¦ä¼šäº†æ‰§è¡Œç‰¹æ®Šä»»åŠ¡çš„æ–¹æ³•ï¼ŒæŒæ¡äº†ä¾¦å¯Ÿã€ç ´åç­‰æŠ€èƒ½ã€‚", prerequisites: ["mi3"], requiredWeek: 5, level: 3 }
            ],
            labor: [
                { id: "l1", name: "å»ºæ ¡åŠ³åŠ¨", type: "labor", points: 3, description: "æŒæ¡äº†åŸºæœ¬å»ºè®¾æŠ€èƒ½ï¼Œå­¦ä¼šäº†ä¿®å»ºå·¥äº‹å’Œæˆ¿å±‹ã€‚", prerequisites: [], level: 1, requiredTimes: 2 },
                { id: "l2", name: "å†œä¸šç”Ÿäº§åŠ³åŠ¨", type: "labor", points: 4, description: "å­¦ä¼šäº†è€•ç§å’Œæ”¶è·ï¼Œä½“ä¼šåˆ°äº†åŠ³åŠ¨çš„è‰°è¾›ä¸å…‰è£ã€‚", prerequisites: [], level: 1, requiredTimes: 2 }
            ]
        };

        // ç‰¹æ®Šæ´»åŠ¨ï¼ˆä¼‘æ¯ã€å¨±ä¹ç­‰ï¼‰
        const specialActivities = [
            { id: "rest", name: "ä¼‘æ¯", icon: "ğŸ˜´", type: "rest", effect: { political: -1, military: -1 }, description: "å¥½å¥½ä¼‘æ¯äº†ä¸€ä¸‹ï¼Œæ¢å¤äº†ç²¾åŠ›ï¼Œä½†å­¦ä¹ è¿›åº¦æœ‰æ‰€è½åã€‚" },
            { id: "play", name: "ç©è€", icon: "ğŸ®", type: "play", effect: { political: -2, labor: -1 }, description: "å’ŒåŒå­¦ä»¬ä¸€èµ·ç©è€ï¼Œæ”¾æ¾äº†å¿ƒæƒ…ï¼Œä½†è€½è¯¯äº†ä¸€äº›å­¦ä¹ æ—¶é—´ã€‚" },
            { id: "chat", name: "é—²èŠ", icon: "ğŸ’¬", type: "chat", effect: { mass: 2, political: -1 }, description: "ä¸åŒå­¦ä»¬é—²èŠäº¤æµï¼Œå¢è¿›äº†æ„Ÿæƒ…ï¼Œä½†åˆ†æ•£äº†å­¦ä¹ ç²¾åŠ›ã€‚" },
            { id: "exercise", name: "è‡ªç”±é”»ç‚¼", icon: "ğŸƒ", type: "exercise", effect: { military: 2, political: -1 }, description: "è¿›è¡Œäº†é¢å¤–çš„ä½“èƒ½é”»ç‚¼ï¼Œå¢å¼ºäº†ä½“è´¨ã€‚" },
            { id: "read", name: "è¯¾å¤–é˜…è¯»", icon: "ğŸ“–", type: "read", effect: { political: 2, military: -1 }, description: "é˜…è¯»äº†ä¸€äº›è¯¾å¤–ä¹¦ç±ï¼Œæ‹“å®½äº†è§†é‡ã€‚" },
            { id: "help", name: "å¸®åŠ©åŒå­¦", icon: "ğŸ¤", type: "help", effect: { mass: 3, labor: -1 }, description: "å¸®åŠ©åŒå­¦è§£å†³å›°éš¾ï¼Œå»ºç«‹äº†æ·±åšçš„å‹è°Šã€‚" }
        ];

        // æ¯å‘¨è¯¾ç¨‹å®‰æ’ï¼šæ¯ä¸ªç±»å‹éƒ½å±•ç¤º5é—¨è¯¾ç¨‹
        // æ ¼å¼: { political: æ•°é‡, mass: æ•°é‡, military: æ•°é‡, labor: æ•°é‡ }
        const weeklySchedule = [
            { week: 1, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "å…¥å­¦ç¬¬ä¸€å‘¨" },
            { week: 2, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "åŸºç¡€å­¦ä¹ " },
            { week: 3, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "ç†è®ºæ·±åŒ–" },
            { week: 4, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "å†›æ”¿ç»“åˆ" },
            { week: 5, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "æ€æƒ³æå‡" },
            { week: 6, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "å®æˆ˜å‡†å¤‡" },
            { week: 7, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "ç»¼åˆè®­ç»ƒ" },
            { week: 8, courses: { political: 5, mass: 5, military: 5, labor: 5 }, theme: "æ¯•ä¸šå†²åˆº" }
        ];

        // éšæœºäº‹ä»¶ï¼ˆå¸¦é€‰æ‹©ï¼‰
        const randomEvents = [
            {
                title: "æ•Œæœºç©ºè¢­",
                icon: "âœˆï¸",
                description: "æ•Œæœºæ¥è¢­ï¼è­¦æŠ¥å£°å“å½»æ ¡å›­ï¼Œå¸ˆç”Ÿä»¬å¼€å§‹è½¬ç§»ã€‚åœ¨è¿™ç´§æ€¥æ—¶åˆ»ï¼Œä½ éœ€è¦åšå‡ºé€‰æ‹©...",
                choices: [
                    { text: "å†²åœ¨å‰é¢ç»„ç»‡æ’¤ç¦»", icon: "ğŸƒ", type: "military", effect: { military: 5 }, result: "ä½ å†·é™æŒ‡æŒ¥ï¼Œå¸®åŠ©åŒå­¦ä»¬æœ‰åºæ’¤ç¦»åˆ°é˜²ç©ºæ´ï¼Œå±•ç°äº†å‡ºè‰²çš„å†›äº‹ç´ å…»ã€‚" },
                    { text: "å¸®åŠ©è¡ŒåŠ¨ä¸ä¾¿çš„åŒå­¦", icon: "ğŸ¤", type: "mass", effect: { mass: 4, military: 1 }, result: "ä½ èƒŒèµ·å—ä¼¤çš„åŒå­¦ï¼Œå®‰å…¨è½¬ç§»åˆ°é˜²ç©ºæ´ï¼Œå¤§å®¶éƒ½å¾ˆæ„Ÿæ¿€ä½ çš„å¸®åŠ©ã€‚" },
                    { text: "æ”¶é›†é‡è¦å­¦ä¹ èµ„æ–™", icon: "ğŸ“š", type: "political", effect: { political: 4 }, result: "ä½ å†’é™©æŠ¢æ•‘å‡ºé‡è¦çš„é©å‘½æ–‡çŒ®ï¼Œè¿™äº›èµ„æ–™å¯¹ç»§ç»­å­¦ä¹ è‡³å…³é‡è¦ã€‚" }
                ]
            },
            {
                title: "ç”Ÿäº§ç«èµ›",
                icon: "ğŸŒ¾",
                description: "å­¦æ ¡ç»„ç»‡å¼€å±•å¤§ç”Ÿäº§è¿åŠ¨ï¼Œå„ç­éƒ½åœ¨ç§¯æå‚ä¸ã€‚ä½ æ‰“ç®—æ€ä¹ˆå‚åŠ ï¼Ÿ",
                choices: [
                    { text: "åŸ‹å¤´è‹¦å¹²å¼€è’ç§åœ°", icon: "ğŸ”¨", type: "labor", effect: { labor: 5 }, result: "ä½ æŒ¥æ±—å¦‚é›¨ï¼Œå¼€å¦äº†å¤§ç‰‡è’åœ°ï¼Œæˆä¸ºåŠ³åŠ¨æ ‡å…µã€‚" },
                    { text: "ç»„ç»‡åŒå­¦åˆ†å·¥åˆä½œ", icon: "ğŸ‘¥", type: "mass", effect: { mass: 4, labor: 2 }, result: "ä½ åˆç†åˆ†é…ä»»åŠ¡ï¼Œå¸¦é¢†å¤§å®¶é«˜æ•ˆå®Œæˆç”Ÿäº§ä»»åŠ¡ï¼Œå±•ç°äº†ç»„ç»‡æ‰èƒ½ã€‚" },
                    { text: "ç ”ç©¶æ”¹è¿›è€•ä½œæ–¹æ³•", icon: "ğŸ’¡", type: "political", effect: { political: 3, labor: 2 }, result: "ä½ æ”¹è‰¯äº†è€•ä½œæŠ€æœ¯ï¼Œæé«˜äº†ç”Ÿäº§æ•ˆç‡ï¼Œç†è®ºè”ç³»å®é™…ã€‚" }
                ]
            },
            {
                title: "ç¾¤ä¼—æ¥è®¿",
                icon: "ğŸ",
                description: "é™„è¿‘æ‘åº„çš„ç¾¤ä¼—æ¥å­¦æ ¡æ…°é—®ï¼Œé€æ¥äº†è‡ªå·±ç§çš„è”¬èœå’Œé¸¡è›‹ã€‚æ ¡é•¿è®©ä½ ä»£è¡¨å­¦ç”Ÿæ¥å¾…ä»–ä»¬ã€‚",
                choices: [
                    { text: "çƒ­æƒ…æ¥å¾…å¹¶äº†è§£ç¾¤ä¼—éœ€æ±‚", icon: "ğŸ¤", type: "mass", effect: { mass: 5 }, result: "ä½ è¯¦ç»†è¯¢é—®æ‘æ°‘çš„å›°éš¾ï¼Œè®°å½•ä¸‹ä»–ä»¬çš„éœ€æ±‚ï¼Œå‡†å¤‡ç»„ç»‡åŒå­¦å¸®åŠ©ä»–ä»¬ã€‚" },
                    { text: "å‘ç¾¤ä¼—å®£è®²é©å‘½é“ç†", icon: "ğŸ“–", type: "political", effect: { political: 4, mass: 1 }, result: "ä½ å‘æ‘æ°‘è®²è§£æŠ—æˆ˜å½¢åŠ¿å’Œå…šçš„æ”¿ç­–ï¼Œä»–ä»¬å¬åæ·±å—é¼“èˆã€‚" },
                    { text: "é‚€è¯·ç¾¤ä¼—å‚è§‚å­¦æ ¡å»ºè®¾", icon: "ğŸ«", type: "labor", effect: { labor: 3, mass: 2 }, result: "ä½ å¸¦é¢†æ‘æ°‘å‚è§‚å­¦æ ¡ï¼Œå±•ç¤ºäº†å¸ˆç”Ÿä»¬çš„å»ºè®¾æˆæœï¼Œå¢è¿›äº†å†›æ°‘æ„Ÿæƒ…ã€‚" }
                ]
            },
            {
                title: "ç†è®ºå­¦ä¹ ä¼š",
                icon: "ğŸ“–",
                description: "å­¦æ ¡ç»„ç»‡äº†ä¸€æ¬¡é‡è¦çš„ç†è®ºå­¦ä¹ ä¼šï¼Œè®¨è®ºå½“å‰æŠ—æˆ˜å½¢åŠ¿å’Œé©å‘½ç­–ç•¥ã€‚ä¼šä¸Šå¾æ±‚å¤§å®¶çš„æ„è§ã€‚",
                choices: [
                    { text: "ç§¯æå‘è¨€é˜è¿°è‡ªå·±è§‚ç‚¹", icon: "ğŸ’¬", type: "political", effect: { political: 5 }, result: "ä½ çš„å‘è¨€è§‚ç‚¹æ·±åˆ»ï¼Œå¾—åˆ°äº†è€å¸ˆçš„è¡¨æ‰¬ï¼Œè¢«æ¨ä¸¾ä¸ºå­¦ä¹ å°ç»„ç»„é•¿ã€‚" },
                    { text: "ç»“åˆå†›äº‹å®è·µåˆ†æé—®é¢˜", icon: "âš”ï¸", type: "military", effect: { military: 3, political: 2 }, result: "ä½ ä»å†›äº‹è§’åº¦åˆ†æäº†æ¸¸å‡»æˆ˜æœ¯çš„è¿ç”¨ï¼Œè®©åŒå­¦ä»¬è€³ç›®ä¸€æ–°ã€‚" },
                    { text: "è”ç³»ç¾¤ä¼—å·¥ä½œåˆ†äº«ç»éªŒ", icon: "ğŸ‘¥", type: "mass", effect: { mass: 3, political: 2 }, result: "ä½ åˆ†äº«äº†ä¸ç¾¤ä¼—äº¤å¾€çš„å¿ƒå¾—ï¼Œå¼ºè°ƒäº†ç¾¤ä¼—è·¯çº¿çš„é‡è¦æ€§ã€‚" }
                ]
            },
            {
                title: "ç´§æ€¥æƒ…æŠ¥",
                icon: "ğŸ¯",
                description: "æ”¶åˆ°æƒ…æŠ¥ï¼Œæ•Œäººå¯èƒ½è¦æ¥è¢­å‡»å­¦æ ¡ã€‚æ ¡é•¿ç´§æ€¥å¬é›†å¤§å®¶å•†è®®å¯¹ç­–ï¼Œä½ è®¤ä¸ºåº”è¯¥...",
                choices: [
                    { text: "ä¸»åŠ¨è¯·ç¼¨å‚åŠ ä¾¦å¯Ÿ", icon: "ğŸ”­", type: "military", effect: { military: 5 }, result: "ä½ å¸¦é¢†å°é˜Ÿæ·±å…¥æ•Œåä¾¦å¯Ÿï¼ŒæˆåŠŸæ‘¸æ¸…äº†æ•Œäººçš„åŠ¨å‘ã€‚" },
                    { text: "ç»„ç»‡ç¾¤ä¼—è½¬ç§»ç‰©èµ„", icon: "ğŸ“¦", type: "mass", effect: { mass: 4, labor: 2 }, result: "ä½ å‘åŠ¨å‘¨å›´ç¾¤ä¼—å¸®å¿™ï¼Œè¿…é€Ÿå°†å­¦æ ¡ç‰©èµ„è½¬ç§»åˆ°å®‰å…¨åœ°ç‚¹ã€‚" },
                    { text: "å¸ƒç½®é˜²å¾¡å·¥äº‹", icon: "ğŸ”¨", type: "labor", effect: { labor: 4, military: 2 }, result: "ä½ å¸¦é¢†åŒå­¦ä»¬ä¿®å»ºé˜²å¾¡å·¥äº‹ï¼Œä¸ºå­¦æ ¡æ„ç­‘äº†åšå›ºçš„é˜²çº¿ã€‚" }
                ]
            },
            {
                title: "æ‘æ°‘æ±‚åŠ©",
                icon: "ğŸ†˜",
                description: "é™„è¿‘æ‘åº„é­é‡å›°éš¾ï¼Œåº„ç¨¼æ€¥éœ€æŠ¢æ”¶ï¼Œæ‘æ°‘å¸Œæœ›å­¦æ ¡èƒ½æ´¾äººå¸®å¿™ã€‚ä½ å†³å®š...",
                choices: [
                    { text: "äº²è‡ªä¸‹åœ°å¸®å¿™æ”¶å‰²", icon: "ğŸŒ¾", type: "labor", effect: { labor: 5 }, result: "ä½ æŒ¥èˆé•°åˆ€ï¼Œä¸€å¤©å°±å¸®æ‘æ°‘æ”¶å‰²äº†ä¸‰äº©åœ°ï¼Œç´¯å¾—æ»¡å¤´å¤§æ±—ä½†å¾ˆå……å®ã€‚" },
                    { text: "ç»„ç»‡åŒå­¦è½®æµæ”¯æ´", icon: "ğŸ‘¥", type: "mass", effect: { mass: 5 }, result: "ä½ åˆ¶å®šäº†è¯¦ç»†çš„æ”¯æ´è®¡åˆ’ï¼Œç»„ç»‡åŒå­¦ä»¬è½®æµå¸®å¿™ï¼Œæ‘æ°‘éå¸¸æ„Ÿæ¿€ã€‚" },
                    { text: "å‘æ‘æ°‘ä¼ æˆå†œä¸šçŸ¥è¯†", icon: "ğŸ“š", type: "political", effect: { political: 3, labor: 2 }, result: "ä½ å‘æ‘æ°‘ä»‹ç»äº†ç§‘å­¦ç§ç”°çš„æ–¹æ³•ï¼Œå¸®åŠ©ä»–ä»¬æé«˜äº†è€•ä½œæ•ˆç‡ã€‚" }
                ]
            },
            {
                title: "å¤œé—´è­¦æŠ¥",
                icon: "ğŸŒ™",
                description: "æ·±å¤œï¼Œå€¼ç­çš„ä½ å‘ç°äº†å¯ç–‘åŠ¨é™ã€‚ä½ ä¼šæ€ä¹ˆå¤„ç†ï¼Ÿ",
                choices: [
                    { text: "ç‹¬è‡ªå‰å»ä¾¦å¯Ÿæƒ…å†µ", icon: "ğŸ”¦", type: "military", effect: { military: 5 }, result: "ä½ æ‚„æ‚„æ¥è¿‘æŸ¥çœ‹ï¼Œå‘ç°æ˜¯é‡çŒªåœ¨æ´»åŠ¨ï¼Œè™šæƒŠä¸€åœºï¼Œä½†ä½ çš„è­¦è§‰æ€§å¾—åˆ°äº†è‚¯å®šã€‚" },
                    { text: "ç«‹å³æŠ¥å‘Šå¹¶ç»„ç»‡è­¦æˆ’", icon: "ğŸ“¢", type: "political", effect: { political: 4, military: 1 }, result: "ä½ è¿…é€ŸæŠ¥å‘Šæƒ…å†µï¼ŒæŒ‰ç¨‹åºç»„ç»‡è­¦æˆ’ï¼Œå±•ç°äº†è‰¯å¥½çš„çºªå¾‹æ€§ã€‚" },
                    { text: "å«é†’åŒå­¦ä¸€èµ·æŸ¥çœ‹", icon: "ğŸ¤", type: "mass", effect: { mass: 3, military: 2 }, result: "ä½ å«é†’å‡ ä¸ªåŒå­¦ä¸€èµ·è¡ŒåŠ¨ï¼Œå¤§å®¶ç›¸äº’é…åˆï¼Œå®‰å…¨å¤„ç†äº†æƒ…å†µã€‚" }
                ]
            },
            {
                title: "æ–‡è‰ºæ™šä¼š",
                icon: "ğŸ­",
                description: "å­¦æ ¡è¦ä¸¾åŠæ–‡è‰ºæ™šä¼šï¼Œé¼“èˆå£«æ°”ã€‚ä½ æ‰“ç®—æ€ä¹ˆå‚ä¸ï¼Ÿ",
                choices: [
                    { text: "è¡¨æ¼”é©å‘½æ­Œæ›²", icon: "ğŸµ", type: "political", effect: { political: 4, mass: 1 }, result: "ä½ æ¼”å”±çš„ã€Šä¹‰å‹‡å†›è¿›è¡Œæ›²ã€‹æ¿€æ˜‚æœ‰åŠ›ï¼Œå°ä¸‹æŒå£°é›·åŠ¨ã€‚" },
                    { text: "ç»„ç»‡æ­å»ºèˆå°", icon: "ğŸ”¨", type: "labor", effect: { labor: 4, mass: 1 }, result: "ä½ å¸¦é¢†åŒå­¦ä»¬æ­å»ºäº†æ¼‚äº®çš„èˆå°ï¼Œå¤§å®¶éƒ½ç§°èµä½ çš„æ‰‹è‰ºã€‚" },
                    { text: "åŠ¨å‘˜ç¾¤ä¼—ä¸€èµ·å‚åŠ ", icon: "ğŸ‘¥", type: "mass", effect: { mass: 5 }, result: "ä½ é‚€è¯·äº†é™„è¿‘æ‘æ°‘æ¥è§‚çœ‹ï¼Œæ™šä¼šæ°”æ°›çƒ­çƒˆï¼Œå†›æ°‘åŒä¹ã€‚" }
                ]
            },
            {
                title: "ç‰©èµ„ç´§ç¼º",
                icon: "ğŸ“¦",
                description: "å­¦æ ¡ç‰©èµ„ç´§ç¼ºï¼Œéœ€è¦æƒ³åŠæ³•è§£å†³ã€‚ä½ è§‰å¾—åº”è¯¥...",
                choices: [
                    { text: "ç»„ç»‡å¼€è’è‡ªç»™è‡ªè¶³", icon: "ğŸŒ±", type: "labor", effect: { labor: 5 }, result: "ä½ å¸¦é¢†åŒå­¦ä»¬å¼€å¦èœåœ°ï¼Œç§ä¸Šäº†å„ç§è”¬èœï¼Œéƒ¨åˆ†è§£å†³äº†åƒèœé—®é¢˜ã€‚" },
                    { text: "è”ç³»ç¾¤ä¼—äº¤æ¢ç‰©èµ„", icon: "ğŸ¤", type: "mass", effect: { mass: 4, labor: 1 }, result: "ä½ è”ç³»é™„è¿‘æ‘æ°‘ä»¥åŠ³åŠ¨æ¢å–ç‰©èµ„ï¼Œå»ºç«‹äº†äº’åŠ©å…³ç³»ã€‚" },
                    { text: "ç ”ç©¶èŠ‚çº¦ä½¿ç”¨æ–¹æ¡ˆ", icon: "ğŸ“‹", type: "political", effect: { political: 4, labor: 1 }, result: "ä½ åˆ¶å®šäº†è¯¦ç»†çš„ç‰©èµ„ä½¿ç”¨è®¡åˆ’ï¼Œåˆç†åˆ†é…ï¼Œæœç»æµªè´¹ã€‚" }
                ]
            },
            {
                title: "æ–°åŒå­¦å…¥å­¦",
                icon: "ğŸ’",
                description: "ä¸€æ‰¹æ–°åŒå­¦åˆšå…¥å­¦ï¼Œå¯¹å­¦æ ¡ç”Ÿæ´»è¿˜ä¸é€‚åº”ã€‚ä½œä¸ºè€å­¦å‘˜ï¼Œä½ æ‰“ç®—...",
                choices: [
                    { text: "è®²è§£å­¦æ ¡è§„ç« åˆ¶åº¦", icon: "ğŸ“–", type: "political", effect: { political: 4, mass: 1 }, result: "ä½ è¯¦ç»†ä»‹ç»äº†å­¦æ ¡çš„å†å²å’Œåˆ¶åº¦ï¼Œå¸®åŠ©æ–°åŒå­¦å¿«é€Ÿäº†è§£å­¦æ ¡ã€‚" },
                    { text: "å¸¦ä»–ä»¬ç†Ÿæ‚‰æ ¡å›­ç¯å¢ƒ", icon: "ğŸš¶", type: "mass", effect: { mass: 5 }, result: "ä½ çƒ­æƒ…åœ°å¸¦é¢†æ–°åŒå­¦å‚è§‚æ ¡å›­ï¼Œå¤§å®¶å¾ˆå¿«å°±ç†Ÿæ‚‰èµ·æ¥äº†ã€‚" },
                    { text: "æ•™ä»–ä»¬åŸºæœ¬å†›äº‹åŠ¨ä½œ", icon: "âš”ï¸", type: "military", effect: { military: 4, mass: 1 }, result: "ä½ æ•™æ–°åŒå­¦ç«™å†›å§¿ã€é½æ­¥èµ°ï¼Œä»–ä»¬å­¦å¾—å¾ˆè®¤çœŸã€‚" }
                ]
            }
        ];

        // ç»“å±€å®šä¹‰
        const endings = {
            political: {
                icon: "ğŸ“•",
                title: "é©å‘½ç†è®ºå®¶",
                description: "ç»è¿‡16å‘¨çš„åˆ»è‹¦å­¦ä¹ ï¼Œä½ åœ¨æ”¿æ²»ç†è®ºæ–¹é¢å±•ç°å‡ºäº†å“è¶Šçš„æ‰èƒ½ã€‚ä½ æ·±åˆ»ç†è§£é©¬åˆ—ä¸»ä¹‰åŸºæœ¬åŸç†ï¼Œèƒ½å¤Ÿè¿ç”¨ç§‘å­¦çš„ä¸–ç•Œè§‚åˆ†æé—®é¢˜ã€‚æ¯•ä¸šåï¼Œä½ è¢«åˆ†é…åˆ°æ ¹æ®åœ°çš„å…šæ ¡ä»»æ•™ï¼Œä¸ºåŸ¹å…»æ›´å¤šé©å‘½å¹²éƒ¨è´¡çŒ®åŠ›é‡ã€‚ä½ çš„ç†è®ºæ–‡ç« åœ¨ã€Šè§£æ”¾æ—¥æŠ¥ã€‹ä¸Šå‘è¡¨ï¼Œå½±å“äº†æ— æ•°é©å‘½é’å¹´ã€‚"
            },
            military: {
                icon: "âš”ï¸",
                title: "æŠ—æ—¥è‹±é›„",
                description: "ç»è¿‡16å‘¨çš„ä¸¥æ ¼è®­ç»ƒï¼Œä½ æˆä¸ºäº†ä¸€åå‡ºè‰²çš„å†›äº‹äººæ‰ã€‚ä½ ç²¾é€šæ¸¸å‡»æˆ˜æœ¯ï¼Œä½œæˆ˜å‹‡çŒ›æœæ•¢ã€‚æ¯•ä¸šåï¼Œä½ åŠ å…¥äº†å…«è·¯å†›æŸéƒ¨é˜Ÿï¼Œå‚ä¸äº†å¤šæ¬¡é‡è¦æˆ˜å½¹ã€‚ä½ å¸¦é¢†çš„å°åˆ†é˜Ÿå¤šæ¬¡æ·±å…¥æ•Œåï¼Œç»™æ—¥å¯‡ä»¥æ²‰é‡æ‰“å‡»ï¼Œè¢«æˆ˜å£«ä»¬äº²åˆ‡åœ°ç§°ä¸º'ç¥æªæ‰‹'ã€‚"
            },
            labor: {
                icon: "ğŸ”¨",
                title: "åŠ³åŠ¨æ¨¡èŒƒ",
                description: "ç»è¿‡16å‘¨çš„å®è·µé”»ç‚¼ï¼Œä½ æˆä¸ºäº†ç”Ÿäº§æˆ˜çº¿ä¸Šçš„æ¨¡èŒƒã€‚ä½ æŒæ¡äº†ç²¾æ¹›çš„åŠ³åŠ¨æŠ€èƒ½ï¼Œåœ¨å¤§ç”Ÿäº§è¿åŠ¨ä¸­è¡¨ç°çªå‡ºã€‚æ¯•ä¸šåï¼Œä½ ç•™åœ¨æ ¹æ®åœ°æŒ‡å¯¼å†œä¸šç”Ÿäº§ï¼Œç ”ç©¶æ”¹è‰¯è€•ä½œæ–¹æ³•ï¼Œå¸®åŠ©æ ¹æ®åœ°å®ç°ç²®é£Ÿè‡ªç»™ã€‚ä½ è¢«è¯„ä¸º'åŠ³åŠ¨è‹±é›„'ï¼Œäº‹è¿¹ä¼ éæ•´ä¸ªè¾¹åŒºã€‚"
            },
            mass: {
                icon: "ğŸ‘¥",
                title: "ç¾¤ä¼—é¢†è¢–",
                description: "ç»è¿‡16å‘¨çš„å­¦ä¹ å®è·µï¼Œä½ æˆä¸ºäº†æ°å‡ºçš„ç¾¤ä¼—å·¥ä½œè€…ã€‚ä½ æ·±å…¥ç¾¤ä¼—ï¼Œäº†è§£æ°‘æƒ…ï¼Œå–„äºå‘åŠ¨å’Œç»„ç»‡ç¾¤ä¼—ã€‚æ¯•ä¸šåï¼Œä½ è¢«æ´¾å¾€æ–°è§£æ”¾åŒºå¼€å±•å·¥ä½œï¼ŒæˆåŠŸå»ºç«‹äº†åŸºå±‚æ”¿æƒç»„ç»‡ã€‚åœ¨ä½ çš„åŠªåŠ›ä¸‹ï¼Œå½“åœ°ç¾¤ä¼—ç§¯ææ”¯æŒæŠ—æˆ˜ï¼Œè¸Šè·ƒå‚å†›ï¼Œæˆä¸ºåšå¼ºçš„æŠ—æ—¥å ¡å’ã€‚"
            },
            balanced: {
                icon: "ğŸŒŸ",
                title: "å…¨èƒ½å¹²éƒ¨",
                description: "ç»è¿‡16å‘¨çš„å…¨é¢å­¦ä¹ ï¼Œä½ åœ¨å„æ–¹é¢éƒ½å–å¾—äº†å‡è¡¡çš„å‘å±•ã€‚ä½ æ—¢æ‡‚ç†è®ºåˆèƒ½å®è·µï¼Œæ—¢èƒ½æ‰“ä»—åˆèƒ½ç”Ÿäº§ï¼Œè¿˜å–„äºåšç¾¤ä¼—å·¥ä½œã€‚è¿™æ ·çš„å…¨èƒ½äººæ‰æ­£æ˜¯æ ¹æ®åœ°æ€¥éœ€çš„ï¼æ¯•ä¸šåï¼Œä½ è¢«å§”ä»¥é‡ä»»ï¼Œæˆä¸ºåŸºå±‚æ ¹æ®åœ°çš„è´Ÿè´£äººï¼Œå¸¦é¢†å½“åœ°å†›æ°‘å¼€å±•æŠ—æ—¥æ–—äº‰å’Œç”Ÿäº§å»ºè®¾ã€‚"
            }
        };

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            week: 1,
            maxWeeks: 8,
            maxSelectionsPerWeek: 5, // æ¯å‘¨æœ€å¤šé€‰æ‹©æ•°
            stats: {
                political: 10,
                military: 10,
                labor: 10,
                mass: 10
            },
            maxStat: 100,
            minStat: 0,
            selectedItems: [], // æœ¬å‘¨é€‰æ‹©çš„é¡¹ç›®ï¼ˆè¯¾ç¨‹+æ´»åŠ¨ï¼‰
            completedCourseIds: [], // å·²å®Œå…¨æŒæ¡çš„è¯¾ç¨‹ID
            courseProgress: {}, // è¯¾ç¨‹å­¦ä¹ è¿›åº¦ { courseId: å·²å­¦æ¬¡æ•° }
            pendingRandomEvent: false,
            weeklyAvailableCourses: [] // æœ¬å‘¨å¯é€‰è¯¾ç¨‹
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // éšè—åŠ è½½ç•Œé¢
            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
            }, 1000);

            // ç”Ÿæˆæœ¬å‘¨è¯¾ç¨‹
            generateWeeklyCourses();
            // åˆå§‹åŒ–è¯¾ç¨‹å¡ç‰‡
            renderCourses();
            updateUI();
        }

        // å±æ€§åç§°æ˜ å°„
        const statNames = {
            political: 'æ”¿æ²»ç´ å…»',
            military: 'å†›äº‹èƒ½åŠ›',
            labor: 'åŠ³åŠ¨æŠ€èƒ½',
            mass: 'ç¾¤ä¼—å·¥ä½œ'
        };

        // æ£€æŸ¥è¯¾ç¨‹æ˜¯å¦å¯ä»¥å­¦ä¹ ï¼ˆå¤šç§æ¡ä»¶ï¼‰
        function canLearnCourse(course) {
            const reasons = [];
            
            // 1. æ£€æŸ¥å‘¨æ•°è¦æ±‚
            if (course.requiredWeek && gameState.week < course.requiredWeek) {
                reasons.push({
                    type: 'week',
                    icon: 'ğŸ“…',
                    text: `ç¬¬${course.requiredWeek}å‘¨å¼€æ”¾`,
                    met: false
                });
            }
            
            // 2. æ£€æŸ¥å±æ€§è¦æ±‚
            if (course.requiredStats) {
                Object.entries(course.requiredStats).forEach(([stat, value]) => {
                    if (gameState.stats[stat] < value) {
                        reasons.push({
                            type: 'stat',
                            icon: stat === 'political' ? 'ğŸ“•' : stat === 'military' ? 'âš”ï¸' : stat === 'labor' ? 'ğŸ”¨' : 'ğŸ‘¥',
                            text: `${statNames[stat]}â‰¥${value}`,
                            current: gameState.stats[stat],
                            required: value,
                            met: false
                        });
                    }
                });
            }
            
            // 3. æ£€æŸ¥å‰ç½®è¯¾ç¨‹
            if (course.prerequisites && course.prerequisites.length > 0) {
                const missingPrereqs = course.prerequisites.filter(prereqId => 
                    !gameState.completedCourseIds.includes(prereqId)
                );
                
                if (missingPrereqs.length > 0) {
                    const missingNames = missingPrereqs.map(prereqId => {
                        for (const type of Object.keys(allCourses)) {
                            const found = allCourses[type].find(c => c.id === prereqId);
                            if (found) return found.name;
                        }
                        return prereqId;
                    });
                    reasons.push({
                        type: 'prereq',
                        icon: 'ğŸ“š',
                        text: `éœ€å…ˆå­¦: ${missingNames.join('ã€')}`,
                        met: false
                    });
                }
            }
            
            if (reasons.length === 0) {
                return { canLearn: true, reasons: [] };
            }
            
            return { canLearn: false, reasons: reasons };
        }

        // ç”Ÿæˆè§£é”æ¡ä»¶çš„HTML
        function generateLockReasonHTML(reasons) {
            if (!reasons || reasons.length === 0) return '';
            
            return reasons.map(r => {
                let detail = '';
                if (r.type === 'stat' && r.current !== undefined) {
                    detail = ` (å½“å‰: ${r.current})`;
                }
                return `<div class="lock-reason-item">${r.icon} ${r.text}${detail}</div>`;
            }).join('');
        }

        // ç”Ÿæˆæœ¬å‘¨å¯é€‰è¯¾ç¨‹
        function generateWeeklyCourses() {
            const schedule = weeklySchedule[gameState.week - 1];
            if (!schedule) return;

            gameState.weeklyAvailableCourses = [];

            Object.keys(schedule.courses).forEach(type => {
                const count = schedule.courses[type];
                if (count === 0) return;

                // è·å–è¯¥ç±»å‹æ‰€æœ‰æœªå®Œå…¨æŒæ¡çš„è¯¾ç¨‹
                const availableCourses = allCourses[type].filter(course => 
                    !gameState.completedCourseIds.includes(course.id)
                );

                // æŒ‰levelæ’åºï¼Œä¼˜å…ˆæ˜¾ç¤ºä½çº§åˆ«è¯¾ç¨‹
                // æ­£åœ¨å­¦ä¹ ä¸­çš„è¯¾ç¨‹ï¼ˆæœ‰è¿›åº¦ä½†æœªå®Œæˆï¼‰ä¼˜å…ˆæ˜¾ç¤º
                availableCourses.sort((a, b) => {
                    const aProgress = gameState.courseProgress[a.id] || 0;
                    const bProgress = gameState.courseProgress[b.id] || 0;
                    // æœ‰è¿›åº¦çš„è¯¾ç¨‹ä¼˜å…ˆ
                    if (aProgress > 0 && bProgress === 0) return -1;
                    if (bProgress > 0 && aProgress === 0) return 1;
                    // ç„¶åæŒ‰çº§åˆ«æ’åº
                    return a.level - b.level;
                });

                // é€‰æ‹©æŒ‡å®šæ•°é‡çš„è¯¾ç¨‹
                const selectedCourses = availableCourses.slice(0, count);
                
                selectedCourses.forEach(course => {
                    gameState.weeklyAvailableCourses.push({
                        ...course,
                        type: type
                    });
                });
            });
        }

        // æ¸²æŸ“è¯¾ç¨‹å¡ç‰‡
        function renderCourses() {
            const containers = {
                political: document.getElementById('politicalCourses'),
                mass: document.getElementById('massCourses'),
                military: document.getElementById('militaryCourses'),
                labor: document.getElementById('laborCourses')
            };

            // æ¸…ç©ºå®¹å™¨
            Object.values(containers).forEach(c => c.innerHTML = '');

            // æŒ‰ç±»å‹åˆ†ç»„æ¸²æŸ“
            gameState.weeklyAvailableCourses.forEach(course => {
                const container = containers[course.type];
                if (!container) return;

                const { canLearn, reasons } = canLearnCourse(course);
                const isCompleted = gameState.completedCourseIds.includes(course.id);
                
                const card = document.createElement('div');
                card.className = `course-card ${course.type}`;
                card.dataset.id = course.id;
                card.dataset.type = course.type;
                card.dataset.itemType = 'course';
                
                if (!canLearn) {
                    card.classList.add('locked');
                }
                if (isCompleted) {
                    card.classList.add('completed');
                }

                const levelStars = 'â˜…'.repeat(course.level) + 'â˜†'.repeat(4 - course.level);
                const lockReasonsHTML = !canLearn ? generateLockReasonHTML(reasons) : '';
                
                // è®¡ç®—å­¦ä¹ è¿›åº¦
                const requiredTimes = course.requiredTimes || 1;
                const currentProgress = gameState.courseProgress[course.id] || 0;
                const progressPercent = (currentProgress / requiredTimes) * 100;
                const progressHTML = requiredTimes > 1 ? `
                    <div class="course-progress">
                        <div class="course-progress-fill" style="width: ${progressPercent}%"></div>
                    </div>
                    <div class="course-progress-text">è¿›åº¦: ${currentProgress}/${requiredTimes}</div>
                ` : '';
                
                card.innerHTML = `
                    <span class="course-name">${course.name}</span>
                    <span class="course-level">${levelStars}</span>
                    <span class="course-points">+${course.points}</span>
                    ${requiredTimes > 1 && !isCompleted ? `<span class="course-repeatable">éœ€å­¦${requiredTimes}æ¬¡</span>` : ''}
                    ${progressHTML}
                    ${!canLearn ? `<span class="course-lock-icon">ğŸ”’</span>` : ''}
                    ${!canLearn ? `<div class="course-lock-reasons">${lockReasonsHTML}</div>` : ''}
                    <span class="course-badge">âœ“</span>
                `;
                
                if (canLearn && !isCompleted) {
                    card.onclick = () => toggleCourse(course, card);
                } else if (!canLearn) {
                    card.onclick = () => showMessage(`ğŸ”’ ã€${course.name}ã€‘æš‚æ—¶æ— æ³•å­¦ä¹ \n\nè§£é”æ¡ä»¶ï¼š\n${reasons.map(r => `${r.icon} ${r.text}${r.current !== undefined ? ` (å½“å‰: ${r.current})` : ''}`).join('\n')}`);
                }
                
                container.appendChild(card);
            });

            // å¦‚æœæŸä¸ªç±»å‹æ²¡æœ‰è¯¾ç¨‹ï¼Œæ˜¾ç¤ºæç¤º
            Object.keys(containers).forEach(type => {
                const container = containers[type];
                if (container.children.length === 0) {
                    container.innerHTML = '<div class="no-courses">æœ¬å‘¨æš‚æ— æ­¤ç±»è¯¾ç¨‹å®‰æ’</div>';
                }
            });

            // æ¸²æŸ“ç‰¹æ®Šæ´»åŠ¨
            renderSpecialActivities();

            // æ›´æ–°å‘¨ä¸»é¢˜
            const schedule = weeklySchedule[gameState.week - 1];
            if (schedule) {
                showMessage(`ğŸ“š ç¬¬${gameState.week}å‘¨ - ${schedule.theme}ã€‚æœ€å¤šé€‰5é¡¹ï¼ˆå¯å°‘é€‰ï¼‰ï¼Œéƒ¨åˆ†è¯¾ç¨‹éœ€è¦å¤šæ¬¡å­¦ä¹ æ‰èƒ½å®Œå…¨æŒæ¡ã€‚`);
            }
        }

        // æ¸²æŸ“ç‰¹æ®Šæ´»åŠ¨
        function renderSpecialActivities() {
            const container = document.getElementById('specialActivities');
            if (!container) return;
            container.innerHTML = '';

            specialActivities.forEach(activity => {
                const card = document.createElement('div');
                card.className = 'course-card activity-card';
                card.dataset.id = activity.id;
                card.dataset.itemType = 'activity';

                // ç”Ÿæˆæ•ˆæœæè¿°
                const effectHTML = Object.entries(activity.effect).map(([stat, value]) => {
                    const statName = statNames[stat] || stat;
                    const className = value > 0 ? 'positive' : 'negative';
                    const sign = value > 0 ? '+' : '';
                    return `<span class="${className}">${statName}${sign}${value}</span>`;
                }).join(' ');

                card.innerHTML = `
                    <div class="activity-icon-large">${activity.icon}</div>
                    <span class="course-name">${activity.name}</span>
                    <div class="activity-effect">${effectHTML}</div>
                    <span class="course-badge">âœ“</span>
                `;

                card.onclick = () => toggleActivity(activity, card);
                container.appendChild(card);
            });
        }

        // åˆ‡æ¢æ´»åŠ¨é€‰æ‹©
        function toggleActivity(activity, card) {
            if (card.classList.contains('selected')) {
                // å–æ¶ˆé€‰æ‹©
                card.classList.remove('selected');
                gameState.selectedItems = gameState.selectedItems.filter(item => item.id !== activity.id);
            } else {
                // æ£€æŸ¥æ˜¯å¦å·²é€‰æ»¡
                if (gameState.selectedItems.length >= gameState.maxSelectionsPerWeek) {
                    showMessage("âš ï¸ æœ¬å‘¨å·²é€‰æ»¡5é¡¹ï¼Œè¯·å…ˆå–æ¶ˆéƒ¨åˆ†é€‰æ‹©ã€‚");
                    return;
                }
                // æ·»åŠ é€‰æ‹©
                card.classList.add('selected');
                gameState.selectedItems.push({
                    id: activity.id,
                    type: activity.type,
                    name: activity.name,
                    icon: activity.icon,
                    effect: activity.effect,
                    description: activity.description,
                    itemType: 'activity'
                });
            }

            updateSelectionUI();
        }

        // åˆ‡æ¢è¯¾ç¨‹é€‰æ‹©
        function toggleCourse(course, card) {
            if (card.classList.contains('selected')) {
                // å–æ¶ˆé€‰æ‹©
                card.classList.remove('selected');
                gameState.selectedItems = gameState.selectedItems.filter(item => item.id !== course.id);
            } else {
                // æ£€æŸ¥æ˜¯å¦å·²é€‰æ»¡
                if (gameState.selectedItems.length >= gameState.maxSelectionsPerWeek) {
                    showMessage("âš ï¸ æœ¬å‘¨å·²é€‰æ»¡5é¡¹ï¼Œè¯·å…ˆå–æ¶ˆéƒ¨åˆ†é€‰æ‹©ã€‚");
                    return;
                }
                // æ·»åŠ é€‰æ‹©
                card.classList.add('selected');
                gameState.selectedItems.push({
                    id: course.id,
                    type: course.type,
                    name: course.name,
                    points: course.points,
                    description: course.description,
                    level: course.level,
                    requiredTimes: course.requiredTimes || 1,
                    itemType: 'course'
                });
            }

            updateSelectionUI();
        }

        // æ›´æ–°é€‰æ‹©UI
        function updateSelectionUI() {
            const container = document.getElementById('selectedCourses');
            const counter = document.getElementById('selectionCount');
            const confirmBtn = document.getElementById('confirmBtn');

            container.innerHTML = '';
            gameState.selectedItems.forEach(item => {
                const tag = document.createElement('div');
                tag.className = 'selected-tag';
                const icon = item.itemType === 'activity' ? (item.icon || 'ğŸ¯') : '';
                tag.innerHTML = `
                    ${icon} ${item.name}
                    <span class="remove-btn" onclick="removeItem('${item.id}')">Ã—</span>
                `;
                container.appendChild(tag);
            });

            counter.textContent = gameState.selectedItems.length;
            // åªè¦é€‰æ‹©äº†è‡³å°‘1é¡¹å°±å¯ä»¥ç¡®è®¤
            confirmBtn.disabled = gameState.selectedItems.length === 0;
        }

        // ç§»é™¤é€‰æ‹©é¡¹
        function removeItem(itemId) {
            const card = document.querySelector(`.course-card[data-id="${itemId}"]`);
            if (card) {
                card.classList.remove('selected');
            }
            gameState.selectedItems = gameState.selectedItems.filter(item => item.id !== itemId);
            updateSelectionUI();
        }
        
        // å…¼å®¹æ—§å‡½æ•°å
        function removeCourse(courseId) {
            removeItem(courseId);
        }

        // ç¡®è®¤æœ¬å‘¨è¯¾ç¨‹
        function confirmWeek() {
            if (gameState.selectedItems.length === 0) return;

            // è®°å½•æœ¬å‘¨å˜åŒ–å‰çš„å±æ€§
            const oldStats = { ...gameState.stats };
            const currentWeek = gameState.week;

            // å›¾æ ‡æ˜ å°„
            const courseIcons = {
                political: 'ğŸ“•',
                military: 'âš”ï¸',
                labor: 'ğŸ”¨',
                mass: 'ğŸ‘¥'
            };

            // åˆ†ç¦»è¯¾ç¨‹å’Œæ´»åŠ¨
            const courses = gameState.selectedItems.filter(item => item.itemType === 'course');
            const activities = gameState.selectedItems.filter(item => item.itemType === 'activity');

            // å­˜å‚¨æœ¬å‘¨æ‘˜è¦ä¿¡æ¯
            const summaryItems = [];

            // å¤„ç†è¯¾ç¨‹
            courses.forEach(course => {
                // å¢åŠ å±æ€§
                gameState.stats[course.type] += course.points;
                
                // æ›´æ–°å­¦ä¹ è¿›åº¦
                const requiredTimes = course.requiredTimes || 1;
                gameState.courseProgress[course.id] = (gameState.courseProgress[course.id] || 0) + 1;
                const currentProgress = gameState.courseProgress[course.id];
                
                // åˆ¤æ–­æ˜¯å¦å®Œæˆè¯¾ç¨‹
                const isCompleted = currentProgress >= requiredTimes;
                if (isCompleted && !gameState.completedCourseIds.includes(course.id)) {
                    gameState.completedCourseIds.push(course.id);
                }

                // ç”Ÿæˆæ‘˜è¦æè¿°
                let progressText = '';
                if (requiredTimes > 1) {
                    if (isCompleted) {
                        progressText = ' ã€å·²å®Œå…¨æŒæ¡ï¼ã€‘';
                    } else {
                        progressText = ` ã€è¿›åº¦: ${currentProgress}/${requiredTimes}ã€‘`;
                    }
                }

                summaryItems.push({
                    icon: courseIcons[course.type],
                    name: course.name,
                    description: course.description + progressText,
                    type: course.type,
                    effect: `+${course.points} ${statNames[course.type]}`,
                    isPositive: true
                });
            });

            // å¤„ç†æ´»åŠ¨
            activities.forEach(activity => {
                // åº”ç”¨æ´»åŠ¨æ•ˆæœ
                Object.entries(activity.effect).forEach(([stat, value]) => {
                    gameState.stats[stat] += value;
                });

                // ç”Ÿæˆæ•ˆæœæè¿°
                const effectText = Object.entries(activity.effect).map(([stat, value]) => {
                    const sign = value > 0 ? '+' : '';
                    return `${sign}${value} ${statNames[stat]}`;
                }).join(', ');

                summaryItems.push({
                    icon: activity.icon,
                    name: activity.name,
                    description: activity.description,
                    type: 'activity',
                    effect: effectText,
                    isPositive: false
                });
            });

            // é™åˆ¶å±æ€§æœ€å¤§æœ€å°å€¼
            Object.keys(gameState.stats).forEach(key => {
                if (gameState.stats[key] > gameState.maxStat) {
                    gameState.stats[key] = gameState.maxStat;
                }
                if (gameState.stats[key] < gameState.minStat) {
                    gameState.stats[key] = gameState.minStat;
                }
            });

            // æ˜¾ç¤ºå­¦ä¹ æ€»ç»“å¼¹çª—
            document.getElementById('summaryWeekBadge').textContent = `ç¬¬ ${currentWeek} å‘¨`;
            
            // æ¸²æŸ“è¯¾ç¨‹åˆ—è¡¨
            const coursesContainer = document.getElementById('summaryCourses');
            coursesContainer.innerHTML = '';
            summaryItems.forEach(item => {
                const div = document.createElement('div');
                div.className = `summary-course-item ${item.type}`;
                div.innerHTML = `
                    <div class="summary-course-icon ${item.type}">${item.icon}</div>
                    <div class="summary-course-content">
                        <div class="summary-course-name">${item.name}</div>
                        <div class="summary-course-desc">${item.description}</div>
                    </div>
                    <div class="summary-course-points ${item.isPositive ? '' : 'activity-effect-summary'}">${item.effect}</div>
                `;
                coursesContainer.appendChild(div);
            });

            // æ¸²æŸ“å±æ€§å˜åŒ–
            const statsContainer = document.getElementById('summaryStats');
            statsContainer.innerHTML = '';
            Object.keys(gameState.stats).forEach(type => {
                const change = gameState.stats[type] - oldStats[type];
                const stat = document.createElement('div');
                stat.className = 'summary-stat';
                const changeClass = change > 0 ? 'positive' : (change < 0 ? 'negative' : '');
                const changeText = change > 0 ? '+' + change : change;
                stat.innerHTML = `
                    <div class="summary-stat-value">${gameState.stats[type]}</div>
                    <div class="summary-stat-change ${changeClass}">${changeText}</div>
                    <div class="summary-stat-name">${statNames[type]}</div>
                `;
                statsContainer.appendChild(stat);
            });

            // æ˜¾ç¤ºå¼¹çª—
            document.getElementById('summaryModal').classList.add('show');

            // æ›´æ–°åº•éƒ¨æ¶ˆæ¯
            showMessage(`ğŸ“… ç¬¬${currentWeek}å‘¨å®Œæˆï¼è¯·æŸ¥çœ‹æœ¬å‘¨æ€»ç»“ã€‚`);

            // æ¸…é™¤é€‰æ‹©
            gameState.selectedItems = [];
            document.querySelectorAll('.course-card.selected').forEach(card => {
                card.classList.remove('selected');
            });
            updateSelectionUI();

            // æ¯å‘¨éƒ½è§¦å‘éšæœºäº‹ä»¶
            gameState.pendingRandomEvent = true;

            // è¿›å…¥ä¸‹ä¸€å‘¨
            gameState.week++;
            
            updateUI();
        }

        // å…³é—­å­¦ä¹ æ€»ç»“å¼¹çª—
        function closeSummary() {
            document.getElementById('summaryModal').classList.remove('show');

            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
            if (gameState.week > gameState.maxWeeks) {
                setTimeout(() => showEnding(), 500);
                return;
            }

            // æ£€æŸ¥æ˜¯å¦è§¦å‘éšæœºäº‹ä»¶
            if (gameState.pendingRandomEvent) {
                gameState.pendingRandomEvent = false;
                setTimeout(() => {
                    triggerRandomEvent();
                    // äº‹ä»¶ç»“æŸåé‡æ–°ç”Ÿæˆè¯¾ç¨‹
                }, 300);
            } else {
                // ç”Ÿæˆä¸‹ä¸€å‘¨è¯¾ç¨‹
                generateWeeklyCourses();
                renderCourses();
            }
        }

        // äº‹ä»¶ç»“æŸåè°ƒç”¨
        function afterEventClosed() {
            generateWeeklyCourses();
            renderCourses();
        }

        // å½“å‰äº‹ä»¶
        let currentEvent = null;

        // è§¦å‘éšæœºäº‹ä»¶
        function triggerRandomEvent() {
            currentEvent = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            
            const statNames = {
                political: 'æ”¿æ²»ç´ å…»',
                military: 'å†›äº‹èƒ½åŠ›',
                labor: 'åŠ³åŠ¨æŠ€èƒ½',
                mass: 'ç¾¤ä¼—å·¥ä½œ'
            };

            document.getElementById('eventIcon').textContent = currentEvent.icon;
            document.getElementById('eventTitle').textContent = currentEvent.title;
            document.getElementById('eventDescription').textContent = currentEvent.description;
            document.getElementById('eventQuestion').textContent = 'ä½ ä¼šæ€ä¹ˆåšï¼Ÿ';

            // æ¸²æŸ“é€‰é¡¹
            const choicesContainer = document.getElementById('eventChoices');
            choicesContainer.innerHTML = '';
            
            currentEvent.choices.forEach((choice, index) => {
                const btn = document.createElement('button');
                btn.className = `event-choice-btn ${choice.type}`;
                
                // ç”Ÿæˆæ•ˆæœæ–‡æœ¬
                const effectText = Object.entries(choice.effect)
                    .map(([stat, value]) => `<span class="${stat}-effect">+${value} ${statNames[stat]}</span>`)
                    .join(' ');

                btn.innerHTML = `
                    <div class="choice-text">
                        <span class="choice-icon">${choice.icon}</span>
                        ${choice.text}
                    </div>
                    <div class="choice-effect">${effectText}</div>
                `;
                btn.onclick = () => selectEventChoice(index);
                choicesContainer.appendChild(btn);
            });

            document.getElementById('eventModal').classList.add('show');
        }

        // é€‰æ‹©äº‹ä»¶é€‰é¡¹
        function selectEventChoice(choiceIndex) {
            const choice = currentEvent.choices[choiceIndex];
            
            const statNames = {
                political: 'æ”¿æ²»ç´ å…»',
                military: 'å†›äº‹èƒ½åŠ›',
                labor: 'åŠ³åŠ¨æŠ€èƒ½',
                mass: 'ç¾¤ä¼—å·¥ä½œ'
            };

            // åº”ç”¨æ•ˆæœ
            Object.keys(choice.effect).forEach(stat => {
                gameState.stats[stat] += choice.effect[stat];
                if (gameState.stats[stat] > gameState.maxStat) {
                    gameState.stats[stat] = gameState.maxStat;
                }
            });

            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®
            document.querySelectorAll('.event-choice-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'default';
            });

            // é«˜äº®é€‰ä¸­çš„é€‰é¡¹
            const selectedBtn = document.querySelectorAll('.event-choice-btn')[choiceIndex];
            selectedBtn.style.opacity = '1';
            selectedBtn.style.background = 'linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(212, 175, 55, 0.1))';
            selectedBtn.style.borderColor = 'var(--gold-primary)';

            // ç”Ÿæˆæ•ˆæœæ–‡æœ¬
            const effectText = Object.entries(choice.effect)
                .map(([stat, value]) => `${statNames[stat]} +${value}`)
                .join('ï¼Œ');

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('eventQuestion').innerHTML = `
                <div class="event-result show">
                    <div class="result-text">${choice.result}</div>
                    <div class="result-effect">ğŸ‰ ${effectText}</div>
                </div>
                <button class="event-continue-btn show" onclick="closeEvent()">ç»§ç»­å­¦ä¹  â†’</button>
            `;

            updateUI();
        }

        // å…³é—­äº‹ä»¶
        function closeEvent() {
            document.getElementById('eventModal').classList.remove('show');
            currentEvent = null;
            // ç”Ÿæˆä¸‹ä¸€å‘¨è¯¾ç¨‹
            afterEventClosed();
        }

        // æ›´æ–°UI
        function updateUI() {
            // æ›´æ–°å‘¨æ•°
            document.getElementById('currentWeek').textContent = Math.min(gameState.week, gameState.maxWeeks);

            // æ›´æ–°è¿›åº¦ç¯
            const progress = (gameState.week - 1) / gameState.maxWeeks;
            const circumference = 157; // 2 * PI * 25
            const offset = circumference * (1 - progress);
            document.getElementById('progressCircle').style.strokeDashoffset = offset;

            // æ›´æ–°å±æ€§
            const statTypes = ['political', 'military', 'labor', 'mass'];
            statTypes.forEach(type => {
                const value = gameState.stats[type];
                const percent = (value / gameState.maxStat) * 100;
                document.getElementById(`${type}Value`).textContent = value;
                document.getElementById(`${type}Bar`).style.width = `${percent}%`;
            });
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(msg) {
            document.getElementById('messageContent').innerHTML = msg.replace(/\n/g, '<br>');
        }

        // æ˜¾ç¤ºç»“å±€
        function showEnding() {
            const stats = gameState.stats;
            const maxStat = Math.max(stats.political, stats.military, stats.labor, stats.mass);
            
            let endingType = 'balanced';
            const threshold = 10; // å·®è·é˜ˆå€¼

            if (stats.political === maxStat && stats.political - Math.min(stats.military, stats.labor, stats.mass) > threshold) {
                endingType = 'political';
            } else if (stats.military === maxStat && stats.military - Math.min(stats.political, stats.labor, stats.mass) > threshold) {
                endingType = 'military';
            } else if (stats.labor === maxStat && stats.labor - Math.min(stats.political, stats.military, stats.mass) > threshold) {
                endingType = 'labor';
            } else if (stats.mass === maxStat && stats.mass - Math.min(stats.political, stats.military, stats.labor) > threshold) {
                endingType = 'mass';
            }

            const ending = endings[endingType];

            document.getElementById('endingIcon').textContent = ending.icon;
            document.getElementById('endingIdentity').textContent = ending.title;
            document.getElementById('endingDescription').textContent = ending.description;

            // æ˜¾ç¤ºæœ€ç»ˆå±æ€§
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML = `
                <div class="final-stat">
                    <div class="final-stat-value">${stats.political}</div>
                    <div class="final-stat-name">æ”¿æ²»ç´ å…»</div>
                </div>
                <div class="final-stat">
                    <div class="final-stat-value">${stats.military}</div>
                    <div class="final-stat-name">å†›äº‹èƒ½åŠ›</div>
                </div>
                <div class="final-stat">
                    <div class="final-stat-value">${stats.labor}</div>
                    <div class="final-stat-name">åŠ³åŠ¨æŠ€èƒ½</div>
                </div>
                <div class="final-stat">
                    <div class="final-stat-value">${stats.mass}</div>
                    <div class="final-stat-name">ç¾¤ä¼—å·¥ä½œ</div>
                </div>
            `;

            document.getElementById('endingScreen').classList.add('show');
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
        }

        // é‡æ–°å¼€å§‹
        function restartGame() {
            gameState = {
                week: 1,
                maxWeeks: 8,
                maxSelectionsPerWeek: 5,
                stats: {
                    political: 10,
                    military: 10,
                    labor: 10,
                    mass: 10
                },
                maxStat: 100,
                minStat: 0,
                selectedItems: [],
                completedCourseIds: [],
                courseProgress: {},
                pendingRandomEvent: false,
                weeklyAvailableCourses: []
            };

            document.getElementById('endingScreen').classList.remove('show');
            document.getElementById('startScreen').classList.remove('hidden');
            
            generateWeeklyCourses();
            renderCourses();
            updateSelectionUI();
            updateUI();
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = initGame;
    </script>
</body>
</html>


